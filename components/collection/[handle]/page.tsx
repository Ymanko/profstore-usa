'use client'

import { useEffect, useState } from 'react'
import Link from 'next/link'
import type { Collection } from '@/lib/shopify/types'
import CollectionGrid from '@/components/collection/CollectionGrid'

export default function CollectionPage({ params }: { params: { handle: string } }) {
  const [parent, setParent] = useState<Collection | null>(null)
  const [children, setChildren] = useState<Collection[]>([])

  useEffect(() => {
    async function fetchData() {
      const res = await fetch(`/api/collections/${params.handle}`)
      if (!res.ok) return

      const data: { parent: Collection; children: Collection[] } = await res.json()
      setParent(data.parent)
      setChildren(data.children)
    }

    fetchData()
  }, [params.handle])

  if (!parent) return <p className="text-muted py-5 text-center">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏...</p>

  return (
    <section className="container py-4">
      {/* üçû –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ */}
      <nav aria-label="breadcrumb" className="mb-3">
        <ol className="breadcrumb">
          <li className="breadcrumb-item"><Link href="/">–ì–ª–∞–≤–Ω–∞—è</Link></li>
          <li className="breadcrumb-item"><Link href="/catalog">–ö–∞—Ç–∞–ª–æ–≥</Link></li>
          <li className="breadcrumb-item active" aria-current="page">{parent.title}</li>
        </ol>
      </nav>

      {/* üè∑Ô∏è –ó–∞–≥–æ–ª–æ–≤–æ–∫ */}git add .
git commit -m "Refactor: moved CollectionPage from app to components"

      <h1 className="fs-3 fw-bold mb-3">{parent.title}</h1>

      {/* üìù –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */}
      {parent.description && (
        <p className="text-muted mb-4">{parent.description}</p>
      )}

      {/* üß© –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π */}
      {children.length > 0 ? (
        <CollectionGrid children={children} />
      ) : (
        <p className="text-muted">–ù–µ—Ç –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π</p>
      )}
    </section>
  )
}
